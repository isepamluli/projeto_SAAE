<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Gerenciamento de Usuários</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Lista Usuários -->
  <ion-list *ngIf="usuarios.length > 0; else semUsuarios">
    <ion-item *ngFor="let usuario of usuarios" button (click)="iniciarEdicao(usuario)">
      <ion-label>
        <h2>{{ usuario.nome }}</h2>
        <p>{{ usuario.email }} - {{ usuario.telefone }}</p>
      </ion-label>
      <ion-button slot="end" color="danger" fill="clear"
        (click)="confirmarExclusao(usuario); $event.stopPropagation();">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-list>

  <ng-template #semUsuarios>
    <ion-text color="medium">
      <p class="ion-text-center">Nenhum usuário cadastrado.</p>
    </ion-text>
  </ng-template>

  <ion-button expand="block" color="success" (click)="iniciarCriacao()">+ Novo Usuário</ion-button>

  <!-- Formulário de Criação/Edição -->
  <div *ngIf="modoEdicao || usuarioEditando === null" class="form-container">
    <form [formGroup]="form" (ngSubmit)="salvar()">
      <ion-item>
        <ion-label position="floating">Nome</ion-label>
        <ion-input formControlName="nome"></ion-input>
      </ion-item>
      <ion-note color="danger" *ngIf="form.get('nome')?.touched && form.get('nome')?.invalid">
        Nome deve ter pelo menos 3 caracteres.
      </ion-note>

      <ion-item>
        <ion-label position="floating">Email</ion-label>
        <ion-input type="email" formControlName="email"></ion-input>
      </ion-item>
      <ion-note color="danger" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">
        Informe um email válido.
      </ion-note>

      <ion-item>
        <ion-label position="floating">Telefone</ion-label>
        <ion-input type="tel" formControlName="telefone"></ion-input>
      </ion-item>

      <ion-item *ngIf="!modoEdicao">
        <ion-label position="floating">Senha</ion-label>
        <ion-input type="password" formControlName="senhaHash"></ion-input>
      </ion-item>

      <ion-button expand="block" type="submit" [disabled]="form.invalid">
        {{ modoEdicao ? 'Salvar Alterações' : 'Criar Usuário' }}
      </ion-button>
      <ion-button expand="block" color="medium" (click)="cancelarEdicao()" *ngIf="modoEdicao">Cancelar</ion-button>
    </form>
  </div>
</ion-content>
